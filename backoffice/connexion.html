

<html>	
    <head>
      <title>BackOffice</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
     
       <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,400i,700">
     
    </head>
    <body>
        <center>
            <div  id="retour_data" style="" onclick="document.getElementById('retour_data').innerHTML = '' " ></div>
        </center>
        <!-- navbar -->
       
                        
        <h3>connexion </h3>
        <div class="container">   
                          <div class="form-group">
                                        <h5>Email </h5>
                                        <input type="text" class="form-control" name="email" id="email"  >
                        </div>
                        <div class="form-group">
                            <h5>Mot de passe </h5>
                            <input type="text" class="form-control" name="password" id="password"  >
                </div>
                    <button class="btn btn-success" onclick="submit_connexion()" >Terminer</button>
                    <button class="btn btn-success" onclick="submit_registertest()" >Terminer</button>
        </div> 
        <!-- Lib -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

       <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.18/sl-1.3.0/datatables.min.js"></script>
       <script src="http://cdn.datatables.net/plug-ins/1.10.20/api/fnPagingInfo.js"></script>
        <!-- <script src="js/add_account.js"></script>
       <script src="js/connexion.js"></script>-->
       <script>

function isJson(str) {
    try {
        JSON.parse(str);
    } catch (e) {
        return false;
    }
    return true;
}

    function parseURL(url) {
        var parser = document.createElement('a'),
            searchObject = {},
            queries, split, i;
        // Let the browser do the work
        parser.href = url;
        // Convert query string to object
        queries = parser.search.replace(/^\?/, '').split('&');
        for( i = 0; i < queries.length; i++ ) {
            split = queries[i].split('=');
            searchObject[split[0]] = split[1];
        }
        return {
            protocol: parser.protocol,
            host: parser.host,
            hostname: parser.hostname,
            port: parser.port,
            pathname: parser.pathname,
            search: parser.search,
            searchObject: searchObject,
            hash: parser.hash
        };
    }
    
    //envoie du formulaire 
function submit_connexion(){
	var XHR = new XMLHttpRequest();
	var urlEncodedData = "";
	var urlEncodedDataPairs = [];
	var name;
  
	
	urlEncodedDataPairs.push(encodeURIComponent('email') + '=' + encodeURIComponent($('#email').val()));
	urlEncodedDataPairs.push(encodeURIComponent('password') + '=' + encodeURIComponent($('#password').val()));
	
  
	// Combinez les paires en une seule chaîne de caractères et remplacez tous
	// les espaces codés en % par le caractère'+' ; cela correspond au comportement
	// des soumissions de formulaires de navigateur.
	urlEncodedData = urlEncodedDataPairs.join('&').replace(/%20/g, '+');
  
	// Définissez ce qui se passe en cas de succès de soumission de données
	XHR.onload = function () {
		if (XHR.readyState === XHR.DONE) {
			data = XHR.response;
            if (isJson(data)) {
                info = JSON.parse(data)
			    if (info.message == undefined) {
                    Cookies.set('access_token', info.jwtToken)
                    Cookies.set('id_account', info.id)
                    
			    	document.location.href='index.html';
			    }else {
			    	document.getElementById("retour_data").innerHTML = '<div class="alert alert-danger" style="margin-bottom:0px;width:'+window.innerWidth+'px"><div class="row"><div class="col-md-11 "><center>'+info.mesage+'</center></div><div class="col-md-1"><span onclick="document.getElementById(\'retour_data\').innerHTML = \'\'">&times;</span>	</div></div></div>';
			    					// document.getElementById("myModal").style.display = "block"
			    }
		}
        else {
				document.getElementById("retour_data").innerHTML = '<div class="alert alert-danger" style="margin-bottom:0px;width:'+window.innerWidth+'px"><div class="row"><div class="col-md-11 "><center>'+data+'</center></div><div class="col-md-1"><span onclick="document.getElementById(\'retour_data\').innerHTML = \'\'">&times;</span>	</div></div></div>';
            
        }
        }
        else {
				document.getElementById("retour_data").innerHTML = '<div class="alert alert-danger" style="margin-bottom:0px;width:'+window.innerWidth+'px"><div class="row"><div class="col-md-11 "><center>'+info.mesage+'</center></div><div class="col-md-1"><span onclick="document.getElementById(\'retour_data\').innerHTML = \'\'">&times;</span>	</div></div></div>';
            
        }
	};
  
	// Définissez ce qui arrive en cas d'erreur
	XHR.addEventListener('error', function(event) {
	  alert('Oups! Quelque chose s\'est mal passé.');
	});
  
	// Configurez la requêtes
	XHR.open('POST', 'http://localhost:3000/accounts/authenticate');
  
	// Ajoutez l'en-tête HTTP requise pour requêtes POST de données de formulaire
	XHR.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  
	// Finalement, envoyez les données.
	XHR.send(urlEncodedData);
	
}
 
function submit_registertest(){
	var XHR = new XMLHttpRequest();
	var urlEncodedData = "";
	var urlEncodedDataPairs = [];
	var name;
  
	
	//urlEncodedDataPairs.push(encodeURIComponent('email') + '=' + encodeURIComponent($('#email').val()));
	//urlEncodedDataPairs.push(encodeURIComponent('password') + '=' + encodeURIComponent($('#password').val()));

    urlEncodedDataPairs.push(encodeURIComponent('title') + '=' + encodeURIComponent("Mr"));
    urlEncodedDataPairs.push(encodeURIComponent('firstName') + '=' + encodeURIComponent( "Andres"));
    urlEncodedDataPairs.push(encodeURIComponent('lastName') + '=' + encodeURIComponent("Igea"));
    urlEncodedDataPairs.push(encodeURIComponent('email') + '=' + encodeURIComponent("andres.igea@gmail.com"));
    urlEncodedDataPairs.push(encodeURIComponent('password') + '=' + encodeURIComponent("password"));
    urlEncodedDataPairs.push(encodeURIComponent('confirmPassword') + '=' + encodeURIComponent("password"));
    urlEncodedDataPairs.push(encodeURIComponent('acceptTerms') + '=' + encodeURIComponent(true));
	
  
	// Combinez les paires en une seule chaîne de caractères et remplacez tous
	// les espaces codés en % par le caractère'+' ; cela correspond au comportement
	// des soumissions de formulaires de navigateur.
	urlEncodedData = urlEncodedDataPairs.join('&').replace(/%20/g, '+');
  
	// Définissez ce qui se passe en cas de succès de soumission de données
	XHR.onload = function () {
		if (XHR.readyState === XHR.DONE) {
			data = XHR.response;
            if (isJson(data)) {
                info = JSON.parse(data)
			    if (info.message == undefined) {
                    Cookies.set('access_token', info.jwtToken, { expires: 7 })
                    Cookies.set('id_account', info.id, { expires: 7 })
                    
			    	document.location.href='index.html';
			    }else {
			    	document.getElementById("retour_data").innerHTML = '<div class="alert alert-danger" style="margin-bottom:0px;width:'+window.innerWidth+'px"><div class="row"><div class="col-md-11 "><center>'+info.mesage+'</center></div><div class="col-md-1"><span onclick="document.getElementById(\'retour_data\').innerHTML = \'\'">&times;</span>	</div></div></div>';
			    					// document.getElementById("myModal").style.display = "block"
			    }
		}
        else {
				document.getElementById("retour_data").innerHTML = '<div class="alert alert-danger" style="margin-bottom:0px;width:'+window.innerWidth+'px"><div class="row"><div class="col-md-11 "><center>'+data+'</center></div><div class="col-md-1"><span onclick="document.getElementById(\'retour_data\').innerHTML = \'\'">&times;</span>	</div></div></div>';
            
        }
        }
        else {
				document.getElementById("retour_data").innerHTML = '<div class="alert alert-danger" style="margin-bottom:0px;width:'+window.innerWidth+'px"><div class="row"><div class="col-md-11 "><center>'+info.mesage+'</center></div><div class="col-md-1"><span onclick="document.getElementById(\'retour_data\').innerHTML = \'\'">&times;</span>	</div></div></div>';
            
        }
	};
  
	// Définissez ce qui arrive en cas d'erreur
	XHR.addEventListener('error', function(event) {
	  alert('Oups! Quelque chose s\'est mal passé.');
	});
  
	// Configurez la requêtes
	XHR.open('POST', 'http://localhost:3000/accounts/register');
  
	// Ajoutez l'en-tête HTTP requise pour requêtes POST de données de formulaire
	XHR.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  
	// Finalement, envoyez les données.
	XHR.send(urlEncodedData);
	
}

    
    
    </script>
    
    </body>
        
    </html>